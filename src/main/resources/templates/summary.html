<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<!-- 	<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script> -->
<!-- <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script> -->
	
<!-- 	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script> -->
<!-- 	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" /> -->
<!-- 	<link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">	 -->
	
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css">

	<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap4.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedheader/4.0.1/js/dataTables.fixedHeader.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedheader/4.0.1/js/fixedHeader.dataTables.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/colreorder/2.0.3/js/dataTables.colReorder.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/colreorder/2.0.3/js/colReorder.dataTables.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.dataTables.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.colVis.min.js"></script>
		
	<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap4.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/colreorder/2.0.3/css/colReorder.dataTables.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.dataTables.css"/>

	<link rel="stylesheet" th:href="@{/css/resultTable.css}"/>
	<script src="/js/msToTime.js"></script>
	<script src="/js/numberWithCommas.js"></script>
	
	<script>
// 		$(function() {
// 			$('input[name="dateRange"]').daterangepicker({
// 				opens: 'left'
// 				}, function(start, end, label) {
// 					console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
// 			});
// 		});
	</script>
	
	<style type="text/css">
		table.dataTable thead tr {    
   			background-color: lightblue; 
			color: black;
		}

		table.dataTable tbody tr td {
			border: 1px solid #c0c0c0;
		}
	
		table.dataTable tfoot tr { 
			background-color: lightblue; 
			color: black;
		}
	</style>
	
	<script>
	
		$(document).ready(function(){ 
						
			const oTable = $("#mongodbLogTable").DataTable({
				responsive: true,
				colReorder: true,
				fixedHeader: true,
				colReorder: true,
				layout: { topStart: { buttons: ['colvis', 'pageLength'] }},
				columns: [
					{	data: "queryHash" },
					{	data: "count" },
					{	data: "averageDuration"	},
					{ 	data: "highDuration" },
					{	data: "lowDuration"	},
					{	data: "query" },
					{	data: "planSummary" }
				]
			});
			
			oTable.on('click', 'tbody tr', function (e) {
			    e.currentTarget.classList.toggle('selected');
			});
		 
			document.querySelector('#query-button').addEventListener('click', function () {
				alert(oTable.rows('.selected').data().length + ' row(s) selected');
				
				var queryHashes;
				for (var i = 0; i < oTable.rows('.selected').data().length; i++) {
					var queryHash =  oTable.rows('.selected').data()[i].queryHash;
					var newQueryHash = queryHash.replace("<span>", "");
					newQueryHash = newQueryHash.replace("</span>", "");
					if (i == 0) 
					{
						queryHashes = newQueryHash;
					}
					else {
						queryHashes += ", ";
						queryHashes += newQueryHash;
					}
				}
				alert(queryHashes);
				
// 				const element = document.getElementById("queryHashses");
// 				element.textContent = queryHashes; 
			});
		});
		
 		document.addEventListener("DOMContentLoaded", function () {
 			applyMsToTimeElements();
 			applyNumberWithCommas();
 		});
		
	</script>
	
	 <style>
/* label, input { display:block; } */
/* input.text { margin-bottom:12px; width:95%; padding: .4em; } */
/* fieldset { padding:0; border:0; margin-top:25px; } */
/* h1 { font-size: 1.2em; margin: .6em 0; } */
/* div#users-contain { width: 350px; margin: 20px 0; } */
/* div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; } */
/* div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; } */
/* .ui-dialog .ui-state-error { padding: .3em; } */
/* .validateTips { border: 1px solid transparent; padding: 0.3em; } */
	</style>
  
	<script>
//   $( function() {
//     var dialog, form,
 
//       // From https://html.spec.whatwg.org/multipage/input.html#e-mail-state-%28type=email%29
//       emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
//       name = $( "#name" ),
//       email = $( "#email" ),
//       password = $( "#password" ),
//       allFields = $( [] ).add( name ).add( email ).add( password ),
//       tips = $( ".validateTips" );
 
//     function updateTips( t ) {
//       tips
//         .text( t )
//         .addClass( "ui-state-highlight" );
//       setTimeout(function() {
//         tips.removeClass( "ui-state-highlight", 1500 );
//       }, 500 );
//     }
 
//     function checkLength( o, n, min, max ) {
//       if ( o.val().length > max || o.val().length < min ) {
//         o.addClass( "ui-state-error" );
//         updateTips( "Length of " + n + " must be between " +
//           min + " and " + max + "." );
//         return false;
//       } else {
//         return true;
//       }
//     }
 
//     function checkRegexp( o, regexp, n ) {
//       if ( !( regexp.test( o.val() ) ) ) {
//         o.addClass( "ui-state-error" );
//         updateTips( n );
//         return false;
//       } else {
//         return true;
//       }
//     }
 
//     function addUser() {
//       var valid = true;
//       allFields.removeClass( "ui-state-error" );
 
//       valid = valid && checkLength( name, "username", 3, 16 );
//       valid = valid && checkLength( email, "email", 6, 80 );
//       valid = valid && checkLength( password, "password", 5, 16 );
 
//       valid = valid && checkRegexp( name, /^[a-z]([0-9a-z_\s])+$/i, "Username may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );
//       valid = valid && checkRegexp( email, emailRegex, "eg. ui@jquery.com" );
//       valid = valid && checkRegexp( password, /^([0-9a-zA-Z])+$/, "Password field only allow : a-z 0-9" );
 
//       if ( valid ) {
//         $( "#users tbody" ).append( "<tr>" +
//           "<td>" + name.val() + "</td>" +
//           "<td>" + email.val() + "</td>" +
//           "<td>" + password.val() + "</td>" +
//         "</tr>" );
//         dialog.dialog( "close" );
//       }
//       return valid;
//     }
 
//     dialog = $( "#dialog-form" ).dialog({
//       autoOpen: false,
//       height: 400,
//       width: 350,
//       modal: true,
//       buttons: {
//         "Create an account": addUser,
//         Cancel: function() {
//           dialog.dialog( "close" );
//         }
//       },
//       close: function() {
//         form[ 0 ].reset();
//         allFields.removeClass( "ui-state-error" );
//       }
//     });
 
//     form = dialog.find( "form" ).on( "submit", function( event ) {
//       event.preventDefault();
//       addUser();
//     });
 
//     $( "#create-user" ).button().on( "click", function() {
//       dialog.dialog( "open" );
//     });
//   } );
  </script>
	
</head>
<body>
	
<!-- <div id="dialog-form" title="New Query"> -->
<!-- 	<form action="#" th:object="${query}" th:action="@{query}" method="post"> -->
<!-- 		<fieldset> -->
<!--  			<label for="dateRange"> -->
<!-- 				<span class="required">Date Range: *</span>  -->
<!-- 				<input type="text" th:field="*{dateRange}" name="dateRange" /> <br> -->
<!-- 			</label> -->
			
<!-- 			<label for="availableCollections">Available Query Types: </label> -->
<!-- 			<select id="queryType" name="queryType" th:field="*{queryType}"> -->
<!-- 				<option th:each="queryType : ${availableQueryTypes}" th:value="${queryType}" th:text="${queryType}"></option> -->
<!-- 			</select> <br> -->
			
<!-- 			<label for="availableCollections">Available Collections: </label> -->
<!-- 			<select id="collection" name="collection" th:field="*{collection}"> -->
<!-- 				<option th:each="collection : ${availableCollections}" th:value="${collection}" th:text="${collection}"></option> -->
<!-- 			</select> <br> -->
			
<!-- 			<label for="availableEnvs">Available Environments: </label> -->
<!-- 			<select id="env" name="env" th:field="*{env}"> -->
<!-- 				<option th:each="env : ${availableEnvs}" th:value="${env}" th:text="${env}"></option> -->
<!-- 			</select> <br> -->
 
<!-- 			<label for="availableNodes">Available Clusters: </label> -->
<!-- 			<select id="node" name="node" th:field="*{cluster}"> -->
<!-- 				<option th:each="node : ${availableNodes}" th:value="${node}" th:text="${node}"></option> -->
<!-- 			</select> <br>		 -->
<!--  			<label for="name">Query Hashes:</label> -->
<!--  			<input type="text" name="queryHashes" id="queryHashses" value="" class="text ui-widget-content ui-corner-all"> -->
 
<!--  			Allow form submission with keyboard without duplicating the dialog button -->
<!--  			<input type="submit" tabindex="-1" style="position:absolute; top:-1000px"> -->
<!--  		</fieldset> -->
<!--  	</form> -->
<!-- </div> -->

<!-- <button id="create-user">Create new user</button> -->

	
	<div align="center" th:text="${query.dateRange}"> </div>
		
		<div style="padding:25px">
			<p><button id="query-button">Query Form</button></p>
			<table id="mongodbLogTable" class="table table-striped table-bordered" style="width:100%">
				<thead>
					<tr>
						<th>QueryHash</th>
						<th>Count</th>
						<th>Average Duration</th>
						<th>High Duration</th>
						<th>Low Duration</th>
						<th>Query</th>
						<th>Plan Summary</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="summarylogEntry : ${summaryLogEntries}" th:id="${summarylogEntry.queryHash}">
						<td><span th:text="${summarylogEntry.queryHash}">QueryHash</span></td>
						<td class="numberWithCommas"><span th:text="${summarylogEntry.sum}">Count</span></td>
						<td class="msToTimeElement"><span th:text="${summarylogEntry.averageDuration}">Average Duration</span></td>
						<td class="msToTimeElement"><span th:text="${summarylogEntry.highDuration}">High Duration</span></td>
						<td class="msToTimeElement"><span th:text="${summarylogEntry.lowDuration}">Low Duration</span></td>
						<td><span th:text="${summarylogEntry.cmd}">Query</span></td>
						<td><span th:text="${summarylogEntry.planSummary}">Plan Summary</span></td>
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<th>QueryHash</th>
						<th>Count</th>
						<th>Average Duration</th>
						<th>High Duration</th>
						<th>Low Duration</th>
						<th>Query</th>
						<th>Plan Summary</th>
					</tr>
				</tfoot>
			</table>
		</div>
	</body>
</html>